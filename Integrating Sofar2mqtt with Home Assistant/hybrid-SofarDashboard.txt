title: SOFAR Hybrid
views:
  - theme: Backend-selected
    path: default_view
    title: Live
    icon: ''
    badges: []
    cards:
      - square: false
        columns: 1
        title: House Requirements
        type: grid
        cards:
          - type: entity
            entity: sensor.sofar_load
            name: Load
      - square: false
        columns: 2
        type: grid
        title: Battery
        cards:
          - type: entity
            entity: sensor.sofar_battery_power_absolute
            name: Power
            card_mod:
              style: >
                ha-card {

                color:      {% if is_state('sensor.sofar_battery_status',
                'Discharging') %}
                                  red
                            {% elif is_state('sensor.sofar_battery_status', 'Charging') %}
                                 green
                                {% else %}
                                  black
                                {% endif %}
                }
          - type: entity
            entity: sensor.sofar_battery_status
            name: Status
          - type: entity
            entity: sensor.sofar_battery_temperature
            name: Temp
          - type: gauge
            entity: sensor.sofar_battery_soc
            name: ' '
      - square: false
        columns: 2
        type: grid
        title: Grid
        cards:
          - type: entity
            entity: sensor.sofar_grid_power_absolute
            name: Power
            card_mod:
              style: >
                ha-card {

                color:      {% if is_state('sensor.sofar_grid_status',
                'Importing') %}
                                  red
                            {% elif is_state('sensor.sofar_grid_status', 'Exporting') %}
                                 green
                                {% else %}
                                  black
                                {% endif %}
                }
          - type: entity
            entity: sensor.sofar_grid_status
            name: Status
      - square: false
        title: Solar
        columns: 2
        type: grid
        cards:
          - type: entity
            entity: sensor.sofar_solar_pv_generation
            name: Power
          - type: entity
            entity: sensor.sofar_pv_current
            name: Current
          - type: gauge
            entity: sensor.sofar_solar_pv_generation
            max: 4000
            needle: false
            name: ' '
      - square: false
        title: Inverter
        columns: 2
        type: grid
        cards:
          - type: entity
            entity: sensor.sofar_inverter_state
            name: State
          - type: entity
            entity: sensor.sofar_inverter_temperature
            name: Inverter Temp
  - theme: Backend-selected
    title: Today
    path: today
    badges: []
    cards:
      - square: false
        columns: 1
        type: grid
        title: Generation and Usage
        cards:
          - type: entity
            entity: sensor.sofar_today_s_pv_generation
            name: Solar
          - type: entity
            entity: sensor.sofar_today_s_load
            name: House
          - type: entity
            entity: sensor.sofar_today_s_grid_consumption
            name: Grid Consumption
            style: |
              ha-card {
                color: red;
              }
          - type: entity
            entity: sensor.sofar_today_s_feed_in
            name: Feed-In
            style: |
              ha-card {
                color: green;
              }
          - type: entity
            entity: sensor.sofar_utility_meter_daily_total_battery_charge
            name: Charge
          - type: entity
            entity: sensor.sofar_utility_meter_daily_total_battery_discharge
            name: Discharge
      - square: false
        columns: 1
        type: grid
        title: Costs
        cards:
          - type: entity
            entity: sensor.sofar_today_s_total_generation_earned
            name: Total Earned
            style: |
              ha-card {
                color: green;
              }
          - type: entity
            entity: sensor.sofar_today_s_pv_generation_earned
            name: Generation Earned
            style: |
              ha-card {
                color: green;
              }
          - type: entity
            entity: sensor.sofar_today_s_grid_consumption_cost
            name: Grid Cost
            style: |
              ha-card {
                color: red;
              }
          - type: entity
            entity: sensor.sofar_today_s_feed_in_earned
            name: Feed-In Earned
            style: |
              ha-card {
                color: green;
              }
  - theme: Backend-selected
    title: Other Live Stats
    path: voltage-and-amps
    badges: []
    cards:
      - square: false
        columns: 3
        type: grid
        title: Battery
        cards:
          - type: entity
            entity: sensor.sofar_battery_voltage
            name: Voltage
          - type: entity
            entity: sensor.sofar_battery_current
            name: Current
          - type: entity
            entity: sensor.sofar_battery_cycles
            name: Cycles
      - square: false
        columns: 3
        type: grid
        title: Grid
        cards:
          - type: entity
            entity: sensor.sofar_grid_voltage
            name: Voltage
          - type: entity
            entity: sensor.sofar_grid_current
            name: Current
          - type: entity
            entity: sensor.sofar_grid_frequency
            name: Frequency
      - square: false
        columns: 3
        type: grid
        title: Solar
        cards:
          - type: entity
            entity: sensor.sofar_pv_current
            name: Current
          - type: entity
            entity: sensor.sofar_solar_pv_array_1_generation
            name: Array 1
          - type: entity
            entity: sensor.sofar_solar_pv_array_2_generation
            name: Array 2
      - square: false
        columns: 3
        type: grid
        title: Inverter
        cards:
          - type: entity
            entity: sensor.sofar_system_io_power
            name: IO Power
  - theme: Backend-selected
    title: TODAY'S POWER DIAGRAM
    path: todays-power-diagram
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: Last 10 Days
    path: previous-month
    type: custom:grid-layout
    badges: []
    cards:
      - type: custom:apexcharts-card
        update_interval: 5min
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 2
        graph_span: 11d
        all_series_config:
          stroke_width: 2
          opacity: 0.8
          type: line
        span:
          start: day
          offset: '-10d'
        header:
          show: false
          title: Month To Date
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_utility_meter_daily_pv_generation
            float_precision: 2
            name: PV
            yaxis_id: power
            type: column
            color: '#FABF00'
            unit: kWh
            fill_raw: last
            opacity: 0.4
            group_by:
              func: max
              duration: 1d
            show:
              legend_value: false
          - entity: sensor.sofar_utility_meter_daily_load
            float_precision: 2
            name: Load
            yaxis_id: power
            type: column
            color: '#6FB6C6'
            unit: kWh
            fill_raw: last
            opacity: 0.4
            group_by:
              func: max
              duration: 1d
            show:
              legend_value: false
          - entity: sensor.sofar_utility_meter_daily_feed_in
            float_precision: 2
            name: Feed-In
            yaxis_id: power
            type: column
            color: '#DF681F'
            unit: kWh
            fill_raw: last
            opacity: 0.4
            group_by:
              func: max
              duration: 1d
            show:
              legend_value: false
          - entity: sensor.sofar_utility_meter_daily_grid_consumption
            float_precision: 2
            name: Grid Consumption
            yaxis_id: power
            type: column
            color: '#C18349'
            unit: kWh
            fill_raw: last
            opacity: 0.4
            group_by:
              func: max
              duration: 1d
            show:
              legend_value: false
          - entity: sensor.sofar_utility_meter_daily_total_battery_charge
            float_precision: 2
            name: Charge
            yaxis_id: power
            type: column
            color: '#ABCE7A'
            unit: kWh
            fill_raw: last
            opacity: 0.4
            group_by:
              func: last
              duration: 1d
            show:
              legend_value: false
          - entity: sensor.sofar_utility_meter_daily_total_battery_discharge
            float_precision: 2
            name: Discharge
            yaxis_id: power
            type: column
            color: '#549585'
            unit: kWh
            fill_raw: last
            opacity: 0.4
            group_by:
              func: max
              duration: 1d
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kWh";
                  }
  - theme: Backend-selected
    title: PV Array 1
    path: pv-array-1
    icon: ''
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_solar_pv_array_1_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
  - theme: Backend-selected
    title: PV Array 2
    path: pv-array-2
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_solar_pv_array_2_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
  - theme: Backend-selected
    type: panel
    title: PD -1
    path: sdf
    icon: ''
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
          offset: '-1day'
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: PD-2
    path: pd-2
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
          offset: '-2day'
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: PD -3
    path: pd-3
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
          offset: '-3day'
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: PD -4
    path: pd-4
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
          offset: '-4day'
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    type: panel
    title: PD -5
    path: pd-5
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
          offset: '-5day'
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: PD -6
    path: pd-6
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
          offset: '-6day'
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: One Page
    path: x
    layout: {}
    type: custom:grid-layout
    badges: []
    cards:
      - square: false
        columns: 2
        type: grid
        cards:
          - type: custom:power-flow-card
            title: Currently...
            kw_decimals: 2
            w_decimals: 2
            entities:
              battery: sensor.sofar_battery_power
              battery_charge: sensor.sofar_battery_soc
              grid: sensor.sofar_grid_power
              solar: sensor.sofar_solar_pv_generation
          - type: custom:sankey-chart
            show_names: true
            unit_prefix: k
            round: 2
            wide: true
            height: 333
            title: Today...
            sections:
              - entities:
                  - entity_id: sensor.sofar_today_s_pv_generation
                    name: PV
                    color: '#FABF00'
                    children:
                      - sensor.sofar_today_s_feed_in
                      - sensor.sofar_today_s_load
                      - sensor.sofar_utility_meter_daily_total_battery_charge
                  - entity_id: sensor.sofar_today_s_grid_consumption
                    color: '#C18349'
                    name: Grid
                    children:
                      - sensor.sofar_today_s_load
                  - entity_id: sensor.sofar_utility_meter_daily_total_battery_discharge
                    name: Discharge
                    color: var(--success-color)
                    children:
                      - sensor.sofar_today_s_load
              - entities:
                  - entity_id: sensor.sofar_today_s_feed_in
                    name: Feed-In
                    color: '#DF681F'
                  - entity_id: sensor.sofar_utility_meter_daily_total_battery_charge
                    name: Charge
                    color: '#F06292'
                  - entity_id: sensor.sofar_today_s_load
                    name: Load
                    color: '#6FB6C6'
                    remaining:
                      name: House
      - square: false
        columns: 5
        type: grid
        title: Currently...
        cards:
          - type: entity
            entity: sensor.sofar_solar_pv_generation
            name: Solar
            card_mod:
              style: |
                ha-card { color: #FABF00 }
          - type: entity
            entity: sensor.sofar_load
            name: Consumption
            card_mod:
              style: |
                ha-card { color: #6FB6C6 }
          - type: entity
            entity: sensor.sofar_battery_power_absolute
            name: BAT Power
            card_mod:
              style: >
                ha-card {

                color:      {% if is_state('sensor.sofar_battery_status',
                'Discharging') %}
                                  red
                            {% elif is_state('sensor.sofar_battery_status', 'Charging') %}
                                 green
                                {% else %}
                                  black
                                {% endif %}
                }
          - type: entity
            entity: sensor.sofar_grid_power_exporting
            name: Feed-In
            card_mod:
              style: |
                ha-card { color: #DF681F }
          - type: entity
            entity: sensor.sofar_grid_power_importing
            name: Grid Usage
            card_mod:
              style: |
                ha-card { color: #C18349 }
      - square: false
        columns: 5
        type: grid
        title: Today...
        cards:
          - type: entity
            entity: sensor.sofar_today_s_pv_generation
            name: Solar
            card_mod:
              style: |
                ha-card { color: #FABF00 }
          - type: entity
            entity: sensor.sofar_today_s_load
            name: Consumption
            card_mod:
              style: |
                ha-card { color: #6FB6C6 }
          - type: entity
            entity: sensor.sofar_battery_soc
            name: BAT SOC
            card_mod:
              style: |
                ha-card { color: #A0C770 }
          - type: entity
            entity: sensor.sofar_today_s_feed_in
            name: Feed-In
            card_mod:
              style: |
                ha-card { color: #DF681F }
          - type: entity
            entity: sensor.sofar_today_s_grid_consumption
            name: Grid Usage
            card_mod:
              style: |
                ha-card { color: #C18349 }
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: true
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
        header:
          show: false
          title: Battery
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_battery_soc
            name: BAT
            transform: return x;
            yaxis_id: battery
            type: area
            color: '#A0C770'
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_load
            float_precision: 2
            name: Load
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#6FB6C6'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_solar_pv_generation
            float_precision: 2
            name: PV
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#FABF00'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.5
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_exporting
            float_precision: 2
            name: Feed-In
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#DF681F'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
          - entity: sensor.sofar_grid_power_importing
            float_precision: 2
            name: Grid Consumption
            transform: return x / 1000;
            yaxis_id: power
            type: area
            color: '#C18349'
            unit: kW
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.3
            group_by:
              func: avg
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: power
            min: 0
            decimals: 2
            apex_config:
              forceNiceScale: true
              title:
                text: POWER
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " kW";
                  }
          - id: battery
            min: 0
            max: 100
            decimals: 0
            opposite: true
            apex_config:
              tickAmount: 5
              title:
                text: BAT
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(0).toString() + " %";
                  }
  - theme: Backend-selected
    title: TODAY'S VOLTAGE
    path: todays-voltage
    icon: ''
    type: panel
    badges: []
    cards:
      - type: custom:apexcharts-card
        apex_config:
          yaxis:
            forceNiceScale: false
          chart:
            height: 600px
          stroke:
            width: 1.5
            curve: smooth
        graph_span: 24h
        all_series_config:
          stroke_width: 1.5
          opacity: 0.4
          type: area
          curve: smooth
        now:
          show: true
          color: red
        span:
          start: day
        header:
          show: false
          title: Voltage
          show_states: true
          colorize_states: true
        series:
          - entity: sensor.sofar_grid_voltage
            float_precision: 2
            name: House Voltage
            transform: return x;
            yaxis_id: voltage
            type: line
            color: blue
            unit: V
            extend_to: now
            curve: smooth
            fill_raw: last
            opacity: 0.6
            group_by:
              func: last
              duration: 5min
            show:
              legend_value: false
        yaxis:
          - id: voltage
            min: 210
            max: 270
            decimals: 2
            apex_config:
              forceNiceScale: false
              title:
                text: VOLTS
              labels:
                formatter: |
                  EVAL:function(value) {
                    return value.toFixed(2).toString() + " V";
                  }
  - theme: Backend-selected
    title: TEST
    path: test
    type: custom:vertical-layout
    layout:
      width: 1000
    badges: []
    cards:
      - type: glance
        entities:
          - entity: sensor.sofar_utility_meter_daily_pv_generation
          - entity: sensor.sofar_utility_meter_daily_load
          - entity: sensor.sofar_battery_soc
          - entity: sensor.sofar_utility_meter_daily_feed_in
          - entity: sensor.sofar_utility_meter_daily_grid_consumption
